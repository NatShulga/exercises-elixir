
В Elixir есть функции, упрощающих работу с абстрактным синтаксическим деревом (АСТ) языка. Например:

```elixir
module = """
  defmodule Example do
    def sum(a, b) do
      a + b
    end
  end
"""

{:ok, result} = Code.string_to_quoted(module)
result
# => {:defmodule, [line: 1],
# =>   [
# =>     {:__aliases__, [line: 1], [:Example]},
# =>     [
# =>       do: {:def, [line: 2],
# =>         [
# =>           {:sum, [line: 2], [{:a, [line: 2], nil}, {:b, [line: 2], nil}]},
# =>           [do: {:+, [line: 3], [{:a, [line: 3], nil}, {:b, [line: 3], nil}]}]
# =>         ]}
# =>   ]
# => ]}

quoted = quote do: 1 + 2

quoted |> Macro.to_string |> IO.puts
# => 1 + 2
# => :ok

quoted_pipe = quote do: 100 |> div(10) |> div(5)
Macro.unpipe(quoted_pipe)
# => [
# =>   {100, 0},
# =>   {{:div, [context: Elixir, imports: [{2, Kernel}]], [10]}, 0},
# =>   {{:div, [context: Elixir, imports: [{2, Kernel}]], [5]}, 0}
# => ]
```

Теперь подведем итоги модуля. Мы рассмотрели, как с помощью макросов можно расширять возможности языка и напрямую работать с АСТ.

Однако, в большинстве случаев прибегать к макросам является плохой затеей:
- Макросы сложнее понимать;
- Макросы сложнее отлаживать;
- Макросы притягивают макросы, то есть приходится писать дополнительные обвязки-макросы.

Перед тем как написать, задумайтесь, есть ли возможность решить задачу с помощью функции? Ответ на этот вопрос почти всегда будет - `да`.

Хоть Elixir помогает и одновременно ограничивает разработчиков, например:
- Макросы по умолчанию гигиеничны;
- Макросы не дают возможности глобально внедрять произвольный код, то есть необходимо напрямую в *конкретном* модуле вызвать `require` или `import` нужного макроса;
- Использование макросов в коде *явно*, поэтому неожиданного поведения, как например, полного переопределения функции, за спиной у разработчика не происходит;
- Использование явных `quote` и `unqoute` тоже упрощает понимание макроса, так как сразу видно, что будет выполнено сразу, а что потом.

Но даже эти механизмы не снимают ответственность с разработчика за написанный им код, пишите макросы ответственно и вдумчиво, и только если в этом есть острая *необходимость*!
